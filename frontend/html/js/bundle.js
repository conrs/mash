!function(t){var e={};function r(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(s,i,function(e){return t[e]}.bind(null,i));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var s={};r.r(s),r.d(s,"Ascii",(function(){return n})),r.d(s,"Stream",(function(){return a})),r.d(s,"LineReader",(function(){return h})),r.d(s,"sleep",(function(){return c})),r.d(s,"request",(function(){return d}));var i={};r.r(i),r.d(i,"Command",(function(){return o})),r.d(i,"Buffer",(function(){return p})),r.d(i,"Mash",(function(){return B}));class o{constructor(){}}class n{static isVisibleText(t){return t==this.Codes.Tab||t==this.Codes.NewLine||t==this.Codes.Backspace||t==this.Codes.Delete||t>=32&&t<=126}static fromCharCode(t){return String.fromCharCode(t)}static characterCodesToString(t){return t.map(n.fromCharCode).join("")}static stringToCharacterCodes(t){return t.split("").map(t=>t.charCodeAt(0))}}n.Codes={StartOfText:2,EndOfTransmission:4,Bell:7,Backspace:8,Tab:9,NewLine:10,ClearScreen:12,CarriageReturn:13,Cancel:24,LeftArrow:17,RightArrow:18,DownArrow:19,UpArrow:20,Delete:127};class a{constructor(){this.buffer=[],this.listener=void 0}hasListener(){return void 0!==this.listener}write(t){if(t=Array.isArray(t)?t:[t],this.buffer=this.buffer.concat(t),this.listener){let t=this.listener.resolve;this.listener=void 0,t()}}read(){if(this.listener)throw new Error("whoa there - one read or listen at a time dawg");let t=this.buffer;return this.buffer=[],t}wait(){if(this.listener)throw new Error("more than one thing is waiting on this stream");return new Promise((t,e)=>{let r=this.read();this.listener={resolve:t,reject:e},r.length>0&&this.write(r)})}async flush(){let t=0;await new Promise(e=>{let r=setInterval(()=>{this.read().length>0?t=0:t++,t>=5&&(clearInterval(r),e())},1)})}async consume(t,e="none"){let r=!0;for(;r;)await this.wait(),r=!1!==t(this.read())}split(t=2){let e=[...Array(t).keys()].map(()=>new a);return this.consume(t=>e.forEach(e=>e.write(t))),e}pipe(t){this.consume(e=>t.write(e))}filter(t){let e=new a;return this.consume(r=>{e.write(r.filter(t))}),e}}class h{constructor(t){this.stream=t,this.lineBuffer=""}async readLine(){await this.stream.consume(t=>{for(let e=0;e<t.length;e++){let r=t[e];if(r==n.Codes.NewLine)return!1;r==n.Codes.Backspace?this.lineBuffer=this.lineBuffer.substring(0,this.lineBuffer.length-1):n.Codes.ClearScreen==r?this.lineBuffer="":n.isVisibleText(r)&&(this.lineBuffer+=n.fromCharCode(r))}return!0});let t=this.lineBuffer;return this.lineBuffer="",t}}function c(t){return new Promise(e=>setTimeout(e,t))}function d(t){return new Promise((e,r)=>{let s=new XMLHttpRequest;s.open(t.method||"GET",t.url),t.headers&&Object.keys(t.headers).forEach(e=>{s.setRequestHeader(e,t.headers[e])}),s.onload=()=>{s.status>=200&&s.status<300?e(s.response||s.responseText):r(s.statusText)},s.onerror=t=>{r(s.statusText)},s.send(t.body)})}class u{constructor(t,e){if(this.x=t,this.y=e,t<0||e<0||!Number.isInteger(t)||!Number.isInteger(e))throw new Error(`Invalid point (${t}, ${e}) -- must be positive integers.`)}}class l{constructor(t,e,r=new u(0,0)){this.stdout=t,this.nodeToLeft=e,this.point=r}handleNode(t){try{let e=this.getMovesForNode(t);return this.nodeToLeft=e.newNode,this.handleMoves(e),!0}catch(t){return!1}}reset(){this.nodeToLeft=void 0,this.point=new u(0,0),this.ohMagicRightNode=void 0}handleMoves(t){let e=t.x<0?n.Codes.LeftArrow:n.Codes.RightArrow,r=t.y<0?n.Codes.UpArrow:n.Codes.DownArrow,s=Math.abs(t.x),i=Math.abs(t.y);for(let t=0;t<s;t++)this.stdout.write(e);for(let t=0;t<i;t++)this.stdout.write(r);this.point.x+=t.x,this.point.y+=t.y}getMovesForNode(t){switch(t.character){case n.Codes.CarriageReturn:if(this.nodeToLeft){let t=this.nodeToLeft;for(;t.left&&t.left.character!=n.Codes.NewLine;)t=t.left;return{x:-1*this.point.x,y:0,newNode:t}}throw new Error("Carriage return does nothing");case n.Codes.DownArrow:let e=this.nodeToLeft?this.nodeToLeft.right:this.ohMagicRightNode;this.ohMagicRightNode=void 0;let r=this.getLine(e,"down");if(r.length>0){let t=Math.min(this.point.x,r.length-1);return{x:t-this.point.x,y:1,newNode:r[t]}}throw new Error("Moving down is not possible");case n.Codes.UpArrow:let s=this.getLine(this.nodeToLeft,"up");if(s.length>0){let t=Math.min(this.point.x,s.length-1);return{x:t-this.point.x,y:-1,newNode:s[t]}}throw new Error("Moving up is not possible");case n.Codes.Backspace:if(this.nodeToLeft){let t=this.nodeToLeft.left,e=this.nodeToLeft.right;if(t&&(t.right=e),e&&(e.left=t),n.Codes.NewLine==this.nodeToLeft.character){let t=this.getLine(this.nodeToLeft,"up");return this.ohMagicRightNode=this.nodeToLeft,{x:t.length-1-this.point.x,y:-1,newNode:this.nodeToLeft.left}}return this.ohMagicRightNode=this.nodeToLeft,{x:-1,y:0,newNode:this.nodeToLeft.left}}break;case n.Codes.LeftArrow:if(this.nodeToLeft){if(this.ohMagicRightNode=this.nodeToLeft,n.Codes.NewLine==this.nodeToLeft.character){let t=this.getLine(this.nodeToLeft,"up");return this.ohMagicRightNode=this.nodeToLeft,{x:t.length-1-this.point.x,y:-1,newNode:this.nodeToLeft.left}}return this.ohMagicRightNode=this.nodeToLeft,{x:-1,y:0,newNode:this.nodeToLeft.left}}throw new Error("Moving left is not possible");case n.Codes.RightArrow:let i=this.nodeToLeft?this.nodeToLeft.right:this.ohMagicRightNode;if(this.ohMagicRightNode=void 0,i)return n.Codes.NewLine==i.character?{x:-1*this.point.x,y:1,newNode:i}:{x:1,y:0,newNode:i};throw new Error("Moving right is not possible");case n.Codes.Delete:if(this.nodeToLeft.right)return{x:0,y:0,newNode:this.nodeToLeft};throw new Error("No character to the right of current cursor");case n.Codes.NewLine:return{x:-1*this.point.x,y:1,newNode:t};default:return this.ohMagicRightNode=void 0,t.left=this.nodeToLeft,this.nodeToLeft&&(this.nodeToLeft.right=t),{x:1,y:0,newNode:t}}}getLine(t,e){let r=t,s=[],i="up"==e?"left":"right";if(r){for(;r[i]&&r.character!=n.Codes.NewLine;)r=r[i];for(r=r[i];r&&r.character!=n.Codes.NewLine;)s.push(r),r=r[i];"left"==i&&(s=s.reverse())}return s}}function f(t,e,r){return 0==t.length?e:f(t.slice(1),r(e,t[0]),r)}class w{constructor(t,e,r){this.character=t,this.left=e,this.right=r}static fromString(t){return f(t.split(""),void 0,(t,e)=>{let r=new g(e.charCodeAt(0),t);return t&&(t.right=r),r})}}class g extends w{}class m extends w{constructor(t,e){super(n.Codes.NewLine,t,e),this.left=t,this.right=e}}class p extends o{constructor(){super(),this.name="buffer",this.helpText="Provides a buffer for user input, echoing it to standard out, and allowing for cursor movement"}async run(t,e,r=[]){if(this.maxWidth=r[0]?parseInt(r[0],10):Number.MAX_SAFE_INTEGER,this.maxWidth<=0||!Number.isInteger(this.maxWidth))throw new Error(`Invalid max width: ${this.maxWidth}. Must be a positive integer`);return this.stdout=e,this.cursorManager=new l(this.stdout),r.length>1?(e.write(n.stringToCharacterCodes(`Too many arguments passed to ${this.name}: ${r}`)),1):new Promise((r,s)=>{t.consume(t=>{for(let r=0;r<t.length;r++){let s=t[r];if(s==n.Codes.ClearScreen){for(;this.cursorManager.nodeToLeft;)e.write(n.Codes.LeftArrow),this.cursorManager.nodeToLeft=this.cursorManager.nodeToLeft.left;for(;this.lastNode;)e.write(n.Codes.Backspace),this.lastNode=this.lastNode.left;this.cursorManager.reset()}else s==n.Codes.StartOfText?(this.cursorManager.reset(),this.lastNode=void 0,this.stdout.write(n.Codes.StartOfText)):this.handleCharacterCode(s)}}).catch(()=>r(1))})}handleCharacterCode(t){var e;let r=new g(t,this.cursorManager.nodeToLeft),s=!this.lastNode||this.cursorManager.nodeToLeft==this.lastNode||(null===(e=this.cursorManager.nodeToLeft)||void 0===e?void 0:e.left)==this.lastNode;if(this.cursorManager.handleNode(r)&&n.isVisibleText(t))if(s)this.lastNode=this.cursorManager.nodeToLeft,this.stdout.write(r.character),this.cursorManager.point.x>=this.maxWidth&&(this.cursorManager.handleNode(new m(this.lastNode)),this.lastNode=this.cursorManager.nodeToLeft,this.stdout.write(n.Codes.NewLine));else{let e=[],r=this.lastNode,s=t==n.Codes.Backspace?this.cursorManager.nodeToLeft:this.cursorManager.nodeToLeft.left;for(;r!=s;)this.stdout.write(n.Codes.Backspace),r instanceof g&&e.push(r),r=r.left;t==n.Codes.Backspace?this.stdout.write(t):s?this.stdout.write(this.cursorManager.nodeToLeft.character):this.stdout.write(t);let i=new l(new a,this.cursorManager.nodeToLeft,this.cursorManager.point),o=this.cursorManager.nodeToLeft;for(;e.length>0;){let t=e.pop();if(t.left=o,o.right=t,this.stdout.write(t.character),i.handleNode(t),i.point.x==this.maxWidth){let e=new m(t);this.stdout.write(n.Codes.NewLine),t.right=e,i.handleNode(e),o=e}else o=t}}}}class C{}class y{}class T extends y{constructor(t){super(),this.nodes=t}children(){return this.nodes}}class L extends class{constructor(t,e=[]){this.root=t,this.pwd=e}async cd(t){let e=this.getSanitizedAbsolutePath(t);return!!await this.getNodeAtPath(t)&&(this.pwd=e,!0)}async getNodeAtPath(t){let e=this.getSanitizedAbsolutePath(t);if(e){let t=this.root;for(;e.length>0;){if(t instanceof C)return;if(t instanceof y){let r=await t.children(),s=e.shift();if(!r[s])return;t=r[s]}}return t}}getSanitizedAbsolutePath(t){const e=t.split("/");let r=""===e[0]?e:this.pwd.concat(e),s=[];for(let t=0;t<r.length;t++)switch(r[t]){case".":case"":break;case"..":if(0!=s.length){s.pop();break}return;default:s.push(r[t])}return s}}{constructor(){super(new T({blog:new b("https://api.github.com/repos/conrs/blog/contents/_posts")}))}}class b extends y{constructor(t){super(),this.url=t}async children(){if(!this.nodes){let t=await d({url:this.url}),e=JSON.parse(t);this.nodes={},e.forEach(t=>{switch(t.type){case"file":this.nodes[t.name]=new x(t.download_url);break;case"dir":this.nodes[t.name]=new b(t.url)}})}return this.nodes}}class x extends C{constructor(t){super(),this.url=t}async contents(){return this._contents||(this._contents=await(await d({url:this.url}))),this._contents}}class A extends o{constructor(t){super(),this.filesystem=t}async run(t,e,r){let i=r[0]?r[0]:".",o=0,n=await this.filesystem.getNodeAtPath(i);if(void 0===n)o=1,await e.write(s.Ascii.stringToCharacterCodes(`Error: Path '${i}' doesn't exist`));else if(n instanceof C)await e.write(s.Ascii.stringToCharacterCodes(i));else if(n instanceof y){let t=await n.children(),r=Object.keys(t).map(e=>t[e]instanceof y?e+"/":e);await e.write(s.Ascii.stringToCharacterCodes(r.join("\n")))}return o}}class N extends o{constructor(t){super(),this.filesystem=t}async run(t,e,r){let i=r[0]?r[0]:"",o=0,n=await this.filesystem.getNodeAtPath(i);if(void 0===n)o=1,await e.write(s.Ascii.stringToCharacterCodes(`Error: Path '${i}' doesn't exist`));else if(n instanceof C){let t=await n.contents();e.write(s.Ascii.stringToCharacterCodes(t))}else n instanceof y&&(o=1,await e.write(s.Ascii.stringToCharacterCodes(`Error: Path '${i}' is not a file`)));return o}}class v extends o{constructor(t){super(),this.filesystem=t}async run(t,e,r){let s=r[0]?r[0]:"",i=await this.filesystem.cd(s)?0:1;return 0!=i?e.write(n.stringToCharacterCodes(`Path '${s}' not found.`)):e.write(n.stringToCharacterCodes("Okey dokey.")),i}}class M extends o{async run(t,e,r){return e.write(s.Ascii.stringToCharacterCodes(r?r.join(" "):"")),0}}class E extends o{async run(t,e,r){let i=1;if(r&&r[0]){let t=parseInt(r[0],10);NaN!=t&&Number.isInteger(t)&&i>0&&i<26?i=t:e.write(s.Ascii.stringToCharacterCodes(`Invalid rotation value: '${t}' - must be positive integer no larger than 25`))}return await t.consume(t=>{try{t.forEach(t=>{if(t==s.Ascii.Codes.EndOfTransmission)throw new S;t>=65&&t<=90?(t+=i)>90&&(t=t-91+65):t>=97&&t<=122&&(t+=i)>122&&(t=t-123+97),e.write(t)})}catch(t){if(t instanceof S)return!1}}),0}}class S{}class B extends o{constructor(){super(...arguments),this.command="mash",this.helpText="shell which interprets commands",this.filesystem=new L,this.shouldInterceptStdin=!1,this.historyTracker=new I,this.prompt=()=>`mash:/${this.filesystem.pwd.join("/")} $ `,this.commands={ls:new A(this.filesystem),cat:new N(this.filesystem),cd:new v(this.filesystem),echo:new M,rotate:new E}}async run(t,e,r=[]){let s=r[0]?parseInt(r[0],10):Number.MAX_SAFE_INTEGER,i=r[1]?r[1]:"",o=new a,[c,d]=t.split();d.consume(t=>{t.forEach(t=>{let e;n.Codes.UpArrow==t&&(e=this.historyTracker.moveUp()),n.Codes.DownArrow==t&&(e=this.historyTracker.moveDown()),void 0!==e?(this.bufferStdin.write(n.Codes.ClearScreen),this.bufferStdin.write(n.stringToCharacterCodes(e))):this.bufferStdin.write(t)})});let u=new a;(new p).run(u,o,[s.toString()]),this.stdin=c,this.bufferStdin=u;let[l,f]=o.split();for(l.consume(t=>{e.write(t)}),u.write(n.stringToCharacterCodes(i));;){u.write(n.stringToCharacterCodes(this.prompt())),u.write(n.Codes.StartOfText),this.shouldInterceptStdin=!0,await f.flush();let t=await new h(f).readLine();this.shouldInterceptStdin=!1,u.write(n.Codes.StartOfText),e.write([...Array(this.prompt().length).keys()].map(()=>n.Codes.LeftArrow)),await this.execute(t)}}async execute(t){this.historyTracker.addLine(t);try{let e=f(t.split("|"),{stream:this.stdin,run:()=>Promise.resolve()},(t,e)=>{let r=e.split(" ").filter(t=>""!=t),s=this.commands[r[0]],i=r.slice(1),o=new a;if(!s)throw new k(r[0]);return{run:async()=>t.run().then(async()=>{await s.run(t.stream,o,i),o.write(n.Codes.EndOfTransmission)}),stream:o}});e.stream.pipe(this.bufferStdin),await e.run(),this.bufferStdin.write(n.Codes.NewLine)}catch(t){if(!(t instanceof k))throw t;this.bufferStdin.write(n.stringToCharacterCodes(t.message))}}}class k extends Error{constructor(t){super(),this.message=`Command '${t}' not found.\n`}}class I{constructor(){this.commandHistory=[],this.currentIndex=0}moveUp(){if(this.currentIndex>0)return this.currentIndex--,this.commandHistory[this.currentIndex]}moveDown(){return this.currentIndex<this.commandHistory.length&&this.currentIndex++,this.currentIndex==this.commandHistory.length?"":this.commandHistory[this.currentIndex]}addLine(t){""!=t&&(this.commandHistory[this.commandHistory.length]=t,this.currentIndex=this.commandHistory.length)}}var R=function(t,e,r,s){return new(r||(r=Promise))((function(i,o){function n(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(n,a)}h((s=s.apply(t,e||[])).next())}))};class P{constructor(t,e,r){this.outputElement=t,this.cursorElement=e,this.stdin=r,this.cursorX=0,this.cursorY=0,this.yShouldBeAtBottom=!0,this.buffer="";let o=Math.floor(document.body.clientWidth/e.clientWidth*.87),n=new s.Stream,a=this.outputElement.innerHTML;this.outputElement.innerHTML="",this.mash=new i.Mash,this.mash.run(r,n,[o.toString(),a]),setInterval(()=>{this.stdin.hasListener()?this.cursorVisible=!this.cursorVisible:this.cursorVisible=!1,this.cursorElement.style.visibility=this.cursorVisible?"hidden":""},600),setInterval(()=>R(this,void 0,void 0,(function*(){let t=n.read();this.processCharacters(t),this.outputElement.innerHTML!=this.buffer&&(this.outputElement.innerHTML=this.buffer),this.yShouldBeAtBottom&&(this.cursorY=this.outputElement.innerText.split("\n").length-1),this.cursorElement.style.left=(this.cursorX*(1.11*Math.round(1e4*e.getBoundingClientRect().width)/1e4)).toString(),this.cursorElement.style.top=(this.cursorY*e.getBoundingClientRect().height).toString()})),10)}processCharacters(t){t.forEach(t=>{switch(t){case s.Ascii.Codes.StartOfText:this.yShouldBeAtBottom=!0,document.getElementsByTagName("body")[0].scrollTop=20*document.getElementsByTagName("body")[0].clientHeight;break;case s.Ascii.Codes.UpArrow:this.yShouldBeAtBottom=!1,this.cursorY=Math.max(0,this.cursorY-1);break;case s.Ascii.Codes.DownArrow:this.cursorY++;break;case s.Ascii.Codes.LeftArrow:this.cursorX=Math.max(0,this.cursorX-1);break;case s.Ascii.Codes.RightArrow:this.cursorX++;break;case s.Ascii.Codes.Backspace:this.buffer=this.buffer.substring(0,this.outputElement.innerHTML.length-1),this.outputElement.innerHTML=this.buffer;break;default:s.Ascii.isVisibleText(t)&&(this.buffer+=s.Ascii.characterCodesToString([t])),document.getElementsByTagName("body")[0].scrollTop=20*document.getElementsByTagName("body")[0].clientHeight}})}}function O(){let t=function(t){let e=new s.Stream,r=i=>{i.forEach(t=>{let r=-1;1==t.length?r=t.charCodeAt(0):"Tab"==t?r="\t".charCodeAt(0):"Enter"==t?r="\n".charCodeAt(0):"ArrowLeft"==t?r=s.Ascii.Codes.LeftArrow:"ArrowRight"==t?r=s.Ascii.Codes.RightArrow:"ArrowDown"==t?r=s.Ascii.Codes.DownArrow:"ArrowUp"==t?r=s.Ascii.Codes.UpArrow:"Backspace"==t&&(r=s.Ascii.Codes.Backspace),-1!=r&&e.write(r)}),t.wait().then(()=>r(t.read()))};return t.wait().then(()=>r(t.read())),e}(function(){let t=new s.Stream;return document.addEventListener("keydown",(function(t){9==t.keyCode&&t.preventDefault()})),document.addEventListener("keyup",(function(e){t.write(e.key),e.stopPropagation(),e.preventDefault()})),t}()),e=document.getElementById("console_output"),r=document.getElementById("cursor");var i;i=t,document.addEventListener("paste",(function(t){let e=t.clipboardData.getData("text");i.write(s.Ascii.stringToCharacterCodes(e))}));new P(e,r,t)}window.meow=new L,document.addEventListener("readystatechange",(function t(e){"complete"===document.readyState&&(O(),document.removeEventListener("readystatechange",t))}))}]);